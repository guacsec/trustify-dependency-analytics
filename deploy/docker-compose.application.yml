version: '3.8'

services:
  trust-da:
    image: trust-da:latest
    container_name: trustify-trust-da
    ports:
      - "8081:8080"  # Application port
      - "9001:9000"  # Management port
    environment:
      # Monitoring
      MONITORING_ENABLED: "false"
      
      # Database
      DB_REDIS_HOST: redis
      DB_REDIS_PORT: 6379
      
      # Trustify
      TRUSTIFY_HOST: ${TRUSTIFY_HOST:-https://rhtpa.stage.devshift.net/api/v2/}
      TRUSTIFY_CLIENT_ID: ${TRUSTIFY_CLIENT_ID:-your-trustify-client-id}
      TRUSTIFY_CLIENT_SECRET: ${TRUSTIFY_CLIENT_SECRET:-your-trustify-client-secret}
      TRUSTIFY_AUTH_SERVER_URL: http://keycloak:8080
    depends_on:
      redis:
        condition: service_healthy
      keycloak:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/q/health/ready"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

networks:
  default:
    name: trustify-network
    external: true
